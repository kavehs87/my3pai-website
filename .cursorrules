# my3pai.com - System Rules (Frontend)

## üß† Task Planning Protocol (Context Anchoring)
For any complex UI task (e.g., "Implement Checkout," "Redesign Profile"), do NOT try to hold everything in chat memory.
1.  **Initialize:** Create a specific plan file: `docs/plans/ui-task-[feature-name].md`.
    * *Note: stored in the shared `docs/` folder.*
2.  **Structure:**
    * **Goal:** One sentence summary.
    * **Context:** Links to relevant files (e.g., `OrderSummary.vue`, `api/order.js`).
    * **Checklist:** Detailed steps.
3.  **Execution Loop:**
    * Read the plan file -> Execute ONE step -> Mark as `[x]` -> Verify.
4.  **Finalization:** When done, update the plan with a summary.

## üìö API Documentation Protocol (Redocly Split)
**Context:** The API documentation is SPLIT into many small files in `docs/openapi/`.
**Rule:** NEVER read or generate a single monolithic `openapi.yaml` file.

### üîç How to READ API Specs (Token Efficient)
1.  **Start at the Skeleton:** Read `docs/openapi/openapi.yaml` first. This file contains the "Map" of all paths.
2.  **Find the Reference:** Locate the path (e.g., `/auth/login`) -> Find the `$ref` (e.g., `./paths/auth/login.yaml`).
3.  **Load the Target:** Read ONLY that specific YAML file to understand the expected JSON response or required fields.
    * *Benefit:* You get the exact API contract without guessing or asking the backend developer.

### üõ†Ô∏è Tooling & Commands
1.  **Generate Docs:** Always use `redocly build-docs openapi/openapi.yaml --output=api-docs.html`.
    * *Note:* Run this inside the `docs/` directory (symlinked).
    * *Never* use `preview-docs` (it is deprecated/broken in this environment).
2.  **Live Editing (Watch Mode):** If asked to "start the docs server," run this `nodemon` command inside `docs/`:
    * `npx nodemon --watch openapi -e yaml --exec "redocly build-docs openapi/openapi.yaml --output=api-docs.html"`

## 0. CRITICAL CONSTRAINTS (HIGHEST PRIORITY)

1. **Google Maps Safety (ANTI-HALLUCINATION):**
   - **NEVER** store Map instances in `data()` or `reactive()`. Vue Proxy breaks `AdvancedMarkerElement`.
   - **MUST USE:** `beforeCreate() { this.map = null }` (Options) OR `shallowRef()` (Composition).
   - **Check:** `if (window.google?.maps)` before loading script.

2. **State:** NO Pinia/Vuex. Use `src/utils/eventBus.js`. Always `.off()` in `beforeUnmount`.

3. **API:** Check `result.success` first. Public endpoints need `{ requireCsrf: false }`.

4. **Env:** Must prefix `VITE_`.

5. **Assets:** Public images must use absolute paths (e.g., `/logo.png`).

## 1. CROSS-PROJECT WORKFLOW

**Context:** User has 3 Cursor windows (Laravel Backend, Admin, Main Frontend). `docs/` is a symlink shared across windows.

**Task:**
1.  **Check Docs First:** Before asking for an API endpoint, check `docs/openapi/` to see if it already exists.
2.  **Requesting New APIs:** If an endpoint is missing from `docs/`, generate a prompt for the Backend Window using this **EXACT TEMPLATE**:

```text
[LARAVEL BACKEND PROMPT]

I need to add/update the following API endpoint(s) for the my3pai.com frontend:

- Feature Description: [Description]
- Endpoint: [Method] [Path]
- Request: [JSON Structure/Multipart]
- Response: { success: true, data: ... }
- Auth: Sanctum
- Validation: [Rules]